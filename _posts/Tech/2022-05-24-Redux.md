# Redux

[TOC]

### ğŸ‰What is Redux?

ìƒíƒœë¥¼ ê´€ë¦¬í•´ì£¼ëŠ” APIì´ë©°, ìµœê·¼ Reactì™€ ì ‘ëª©í•´ì„œ ëœ¨ê³  ìˆëŠ” ì¶”ì„¸ë¼ Reduxí•˜ë©´ Reactë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì§€ë§Œ, ReduxëŠ” Node ëª¨ë“ˆì´ë¼ JS ê¸°ë°˜ìœ¼ë¡œí•˜ëŠ” ëª¨ë“  í”„ë ˆì„ì›Œí¬ëŠ” ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤.

ê°„ë‹¨í•œ í”„ë¡œê·¸ë¨ì„ ì˜ˆë¡œ ë“¤ë©´...

ì•„ë˜ì˜ í”„ë¡œê·¸ë¨ì€ ì‚¬ìš©ìì˜ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ í†µí•´ì„œ add, minusì´ë²¤íŠ¸ë¥¼ ë°œìƒ ì‹œì¼œ countì˜ ê°’ì„ ë³€ê²½í•˜ëŠ” ì˜ˆì œì´ë‹¤.

```js
const add = document.getElementById('add')
const minus = document.getElementById('minus')
const number = document.querySelector('span')

let count = 0
number.innerText = count  

const updateText = () => {
  number.innerText = count  
}

const handleAdd = () => { 
  count = count + 1
  updateText()
}
const handleMinus = () => {
  count = count - 1
  updateText()
}

add.addEventListener('click', handleAdd)
minus.addEventListener('click', handleMinus)
```

```html
  <body>
    <button id="add">Add</button>
    <span>0</span>
    <button id="minus">Minus</button>
  </body>
```

ê°„ë‹¨í•˜ê²Œ ì½”ë“œì— ëŒ€í•´ ì„¤ëª…í•˜ë©´, htmlì— ìˆëŠ” add, minusë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ê°ê° ìš”ì²­ì— ë§ê²Œ countë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì´ë ‡ê²Œ í•˜ë©´ ë°ì´í„°ë¥¼ ìˆ˜ì • í• ë•Œë§ˆë‹¤ ë Œë”ë§ì´ ë°œìƒí•˜ê³ , ì½”ë“œê°€ ê¸¸ì–´ì§ˆìˆ˜ë¡ ê´€ë¦¬í•˜ê¸°ë„ í˜ë“¤ì–´ì§‘ë‹ˆë‹¤.

Reduxì˜ ê°€ì¥ í° ì¥ì ì„ ì˜ˆë¡œ ë“¤ë©´ MVC íŒ¨í„´ì˜ ë‹¨ì ì¸ ì–‘ë°©í–¥ ë°ì´í„° íë¦„ìœ¼ë¡œ ê´€ë¦¬ê°€ ë³µì¡í•œ ë¶€ë¶„ì„ storeì—ì„œ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— stateê´€ë¦¬ë¥¼ ìˆ˜ì›”í•˜ê²Œ ë„ì™€ ì¤ë‹ˆë‹¤.



---



### ğŸ‰How to use Redux?

ìœ„ Vanilla JSì— Reduxë¥¼ í†µí•´ì•¼ë§Œ stateë³€ê²½ í•  ìˆ˜ ìˆë„ë¡ ë³€ê²½í–ˆë‹¤.

```js
import { createStore } from 'redux'
const add = document.getElementById('add')
const minus = document.getElementById('minus')
const number = document.querySelector('span')


const countModifier = (count = 0, action) => {
  if (action.type === 'ADD')
    return count + 1
  else if (action.type === 'MINUS')
    return count - 1
  else
    return count
}
const countStore = createStore(countModifier)
const onChange = () => {
  number.innerText = countStore.getState()
}

countStore.subscribe(onChange)


const addHandler = () => {
  countStore.dispatch({ type: 'ADD' })
}

const minusHandler = () => {
 countStore.dispatch({ type: 'MINUS' })
}

add.addEventListener('click', addHandler)
minus.addEventListener('click', minusHandler)
```

createStoreì— ì¸ì ê°’ìœ¼ë¡œ Reducerë¥¼ ì¤˜ì•¼í•˜ë©°, Reducerë¥¼ í†µí•´ì„œì•¼ë§Œ stateë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

ReduerëŠ” ì‚¬ìš©ìì˜ ì´ë²¤íŠ¸ë¥¼ í†µí•´, ë³€ê²½ë  stateë¥¼ dispatchì— ê°ì²´ë¡œ ë°›ì•„ì„œ Reducerì— ë¯¸ë¦¬ ì‘ì„±ëœ í”„ë¡œì„¸ìŠ¤ ë°ë¡œ ì²˜ë¦¬í•œë‹¤.

ì´ ë•Œ ë°ì´í„°ë¥¼ ë¬´ì¡°ê±´ Object ì•ˆì— typeì´ ìˆì–´ì•¼ í•œë‹¤.(ì•„ë‹ˆë©´ error ë°œìƒ)

**event listener => dispatch(with type object) => onChange => Reducer** 



ğŸ“Œ**ReducerëŠ” *mutate* ì¦‰ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ëŠ” ê²ƒì„ ì§€ì–‘í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ  mutateë€ array.push(blabla)ê°™ì€ ë°ì´í„°ë¥¼ ë³€í˜•í•˜ëŠ” ê±´ë°, JSëŠ” ì›ì‹œì  íƒ€ì…(Number, String, Object ë“±)ì„ ì œì™¸í•œ ëª¨ë“  ê²ƒì´ ê°ì²´ì´ê¸° ë•Œë¬¸ì— ë°ì´í„°ê°€ ë°”ë€Œì—ˆëŠ”ì§€ í™•ì¸ í•˜ëŠ” ë°©ë²•ì´ ë°ì´í„°ë¥¼ ì°¸ì¡°í•˜ê³  ìˆëŠ” ì£¼ì†Œê°’ì´ ë°”ë€Œì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•´ Re-Rendering í•©ë‹ˆë‹¤.**



### ğŸ‰What is Redux Toolkit?

stateë¥¼ ê´€ë¦¬í•˜ê¸° í¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” Reduxê°€ ë§‰ìƒ ì‚¬ìš©í•´ë³´ë‹ˆ **ì‘ì„±í•´ì•¼ í•˜ëŠ” ì½”ë“œë“¤** ë•Œë¬¸ì— ì‚¬ìš©í•˜ê¸° **ë” ë³µì¡í•˜ë‹¤**ëŠ” ì˜ê²¬ë“¤ì´ ìƒê²¨ë‚¬ìŠµë‹ˆë‹¤.

```shell
yarn add @reduxjs/toolkit
npm install @reduxjs/toolkit
```

Toolkitì€ ê°€ë™ì„± ë° ì½”ë“œì‘ì„±ì— ë§ì€ ë„ì›€ì„ ì¤ë‹ˆë‹¤.

```javascript
// Original Redux
const ADD = 'ADD'
const DEL = 'DEL'
const addToDo = (text) => {
  return {
    type: ADD,
    text
  }
}

const deleteToDo = (id) => {
  return {
    type: DEL,
    id: parseInt(id)
  }
}

const reducer = (state = [], action) => {
  switch (action.type) {
    case ADD:
      return [{ text: action.text, id: Date.now() }, ...state]
    case DEL:
      return state.filter((toDo) => toDo.id !== action.id)
    default:
      return state
  }
}
```

ê¸°ì¡´ì˜ Reduxì—ì„œëŠ” typeì˜ í†µì¼ë„ ì—†ê³  ê°„ë‹¨í•œ í”„ë¡œê·¸ë¨ì„ ë§Œë“œëŠ”ë°ë„ ì¤‘ë³µì¸ ì½”ë“œê°€ ë§ì•˜ì—ˆìŠµë‹ˆë‹¤.

í¸ë¦¬í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ”ë° ì—­ì„¤ì ì´ê²Œë„ ë¶ˆí¸í•œ ìƒí™©ì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ **Toolkit**ì„ ì´ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ì´

```javascript
import { createAction, createReducer } from '@reduxjs/toolkit'

// ToolKit
const addToDo = createAction('ADD')
const deleteToDo = createAction('DEL')

const reducer = createReducer([], {
  [addToDo]: (state, action) => {
    state.push({ text: action.payload, id: Date.now() })
  },
  [deleteToDo]: (state, action) => 
    state.filter((toDo) => toDo.id !== parseInt(action.payload))
})
```

ê°„ë‹¨í•œ ì½”ë“œë¡œ ë°”ë€Œì—ˆìŠµë‹ˆë‹¤.

stateë¥¼ returní•˜ëŠ” í•¨ìˆ˜ë¥¼ ë”°ë¡œ ë§Œë“¤ì§€ ì•Šì•„ë„ createAction()ì„ í• ë‹¹í›„ í˜¸ì¶œí•˜ë©´ 

```json
{type: 'ADD', payload: 'blabla'}
```

JSONí˜•ì‹ìœ¼ë¡œ stateë¥¼ ì¶œë ¥í•´ ì¤ë‹ˆë‹¤! ì—¬ê¸°ì„œ ê¸°ì¡´ì˜ Reduxì™€ ë‹¤ë¥¸ ì ì€ ê°ê¸° ë‹¤ë¥¸ ì´ë¦„ì˜ stateë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  payloadë¼ëŠ” ì´ë¦„ìœ¼ë¡œ stateë¥¼ ì „ë‹¬í•´ ì£¼ê²Œ ë©ë‹ˆë‹¤

ë˜ switch-caseë¬¸ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì¥ì ‘ì´ ìˆì–´ì„œ ì½”ë“œê°€ ê°„ê²°í•´ì§€ê³ ,

ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì¸ë° state.pushë¥¼ í•˜ë©´ mutateê°€ ë¼ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•´ì•¼ í•˜ì§€ë§Œ node packageì¤‘ì— **immer**ë¼ëŠ” ì—„ì²­ë‚œ íŒ¨í‚¤ì§€ê°€ ìˆëŠ”ë° ê¹Šì€ ë³µì‚¬ë¥¼ ì œê³µí•´ì£¼ì–´ì„œ spreadì—°ì‚°ìë‚˜, ê°œë°œìê°€ ì¼ì¼íˆ ë³µì‚¬í•´ì£¼ì–´ì•¼ í•˜ëŠ” ë²ˆê±°ëŸ¬ì›€ì„ ëŒ€ì‹  í•´ì¤ë‹ˆë‹¤.

ë˜ ê¸°ì¡´ì˜ returnìœ¼ë¡œ ê°’ì„ ë„˜ê²¨ì£¼ëŠ” ë°©ì‹ë„ ê·¸ëŒ€ë¡œ ì œê³µí•˜ë‹ˆ ì›í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•´ë„ ë˜ì§€ë§Œ! returnì„ í• ê²½ìš° ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ non-mutateë¥¼ ì§€í–¥í•˜ê¸° ë•Œë¬¸ì— new mutateë¥¼ returní•´ì•¼í•©ë‹ˆë‹¤.



**í•˜.ì§€.ë§Œ** ì—¬ê¸°ì„œ ë” í¸í•œ ê¸°ëŠ¥ì„ toolkitì€ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.

```js
const addToDo = createAction('ADD')
const deleteToDo = createAction('DEL')

const reducer = createReducer([], {
  [addToDo]: (state, action) => {
    state.push({ text: action.payload, id: Date.now() })
  },
  [deleteToDo]: (state, action) => 
    state.filter((toDo) => toDo.id !== parseInt(action.payload))
})
const store = createStore(reducer)

export const actionCreator = {
  addToDo,
  deleteToDo
}
```

 ê¸°ì¡´ì—ëŠ” createActionì„ í†µí•´ì„œ actionì„ ë§Œë“¤ê³ , reducerì— stateë§ˆë‹¤ ì¼ì¼íˆ ì…ë ¥í•´ ì¤˜ì•¼ í–ˆëŠ”ë°

```js
const toDos = createSlice({
  name: 'toDosReducer',
  initialState: [],
  reducers: {
    add: (state, action) => {
      state.push({ text: action.payload, id: Date.now() })
    },
    remove: (state, action) => 
      state.filter((toDo) => toDo.id !== parseInt(action.payload))
  }
})

const store = configureStore({ reducer: toDos.reducer })
export const { add, remove } = toDos.actions
```

createSliceë¥¼ ì´ìš©í•˜ë©´ reducer, actionì„ í•œë²ˆì— ì„ ì–¸, í• ë‹¹ì´ ê°€ëŠ¥í•˜ë‹¤



> toolkit ì‚¬ìš© ì „

```js
import { createStore } from 'redux'

const ADD = 'ADD'
const DEL = 'DEL'

const addTodo = (text) => {
  return {
    type: ADD,
    text
  }
}

const deleteTodo = (id) => {
  return {
    type: DEL,
    id: parseInt(id)
  }
}

const reducer = (state = [], action) => {
  switch (action.type) {
    case ADD:
      return [{ text: action.text, id: Date.now() }, ...state]
    case DEL:
      return state.filter((toDo) => toDo.id !== action.id)
    default:
      return state
  }
}

export const actionCreator = {
  addTodo,
  deleteTodo
}

const store = createStore(reducer)

export default store 
```



> toolkit ì‚¬ìš© í›„

```js
import { configureStore, createSlice } from '@reduxjs/toolkit'

const toDos = createSlice({
  name: 'toDosReducer',
  initialState: [],
  reducers: {
    add: (state, action) => {
      state.push({ text: action.payload, id: Date.now() })
    },
    remove: (state, action) =>
      state.filter((toDo) => toDo.id !== parseInt(action.payload))
  }
})
export const { add, remove } = toDos.actions
export default configureStore({ reducer: toDos.reducer })
```





------

### Reference

- ë…¸ë§ˆë“œ ì½”ë” Redux ë¬´ë£Œê°•ì˜ 

  https://nomadcoders.co/redux-for-beginners/lobby